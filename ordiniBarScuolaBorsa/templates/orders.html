<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ordine â€” Bar Scuola Borsa</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
/* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --red:     #c8333f;
  --red-dim: rgba(200,51,63,0.18);
  --white:   #f5f0ee;
  --bg:      #0c0808;
  --surface: rgba(255,255,255,0.038);
  --border:  rgba(255,255,255,0.08);
  --border-h:rgba(255,255,255,0.14);
  --text:    rgba(255,255,255,0.88);
  --muted:   rgba(255,255,255,0.38);
  --serif:   'DM Serif Display', Georgia, serif;
  --sans:    'DM Sans', sans-serif;
}

body {
  font-family: var(--sans);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Subtle grain overlay */
body::before {
  content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
  background-size: 200px;
  opacity: 0.5;
}

/* Ambient light */
body::after {
  content:""; position:fixed; pointer-events:none; z-index:0;
  top:-30vh; left:-20vw; width:70vw; height:70vh;
  background: radial-gradient(ellipse, rgba(180,40,50,0.09) 0%, transparent 70%);
}

/* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.navbar {
  position:fixed; top:0; left:0; right:0; z-index:100;
  height:72px;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 40px;
  background: rgba(10,5,5,0.92);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}

.navbar::after {
  content:""; position:absolute; bottom:0; left:0; right:0; height:1px;
  background: linear-gradient(90deg, transparent, rgba(200,51,63,0.4), transparent);
}

.nav-logo { display:flex; align-items:center; gap:10px; text-decoration:none; }
.nav-logo img { width:44px; height:44px; object-fit:contain; filter:drop-shadow(0 0 6px rgba(200,51,63,0.25)); }
.nav-logo-text { display:flex; flex-direction:column; }
.nav-logo-text .l1 { font-size:9px; font-weight:300; letter-spacing:4px; text-transform:uppercase; color:var(--muted); }
.nav-logo-text .l2 { font-size:13px; font-weight:600; letter-spacing:2px; text-transform:uppercase; color:var(--white); }

.nav-links { display:flex; gap:4px; list-style:none; }
.nav-links a { font-size:11px; font-weight:500; letter-spacing:2px; text-transform:uppercase; color:var(--muted); text-decoration:none; padding:7px 14px; border-radius:6px; transition:all 0.2s; }
.nav-links a:hover { color:white; background:rgba(255,255,255,0.06); }
.nav-links li:last-child a { color:rgba(200,51,63,0.8); border:1px solid rgba(200,51,63,0.3); padding:6px 16px; border-radius:20px; }
.nav-links li:last-child a:hover { background:rgba(200,51,63,0.12); color:white; }

.nav-social { display:flex; gap:6px; }
.nav-social a { width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:7px; border:1px solid var(--border); color:var(--muted); font-size:13px; text-decoration:none; transition:all 0.2s; }
.nav-social a:hover { border-color:rgba(200,51,63,0.4); color:rgba(200,51,63,0.8); background:var(--red-dim); }

.menu-toggle { display:none; background:none; border:none; color:white; font-size:22px; cursor:pointer; }

/* â”€â”€ Page Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page {
  position:relative; z-index:1;
  min-height:100vh;
  padding:100px 20px 60px;
  display:flex; flex-direction:column; align-items:center; gap:0;
}

/* â”€â”€ Page Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-head {
  text-align:center;
  margin-bottom:48px;
  animation: rise 0.7s ease both;
}

.page-head .eyebrow {
  display:inline-flex; align-items:center; gap:12px;
  font-size:10px; font-weight:500; letter-spacing:5px;
  text-transform:uppercase; color:var(--red);
  margin-bottom:14px;
}
.page-head .eyebrow::before,
.page-head .eyebrow::after {
  content:""; display:block; width:24px; height:1px;
  background:rgba(200,51,63,0.5);
}

.page-head h1 {
  font-family: var(--serif);
  font-size: clamp(40px, 7vw, 72px);
  font-weight: 400;
  font-style: italic;
  color: var(--white);
  letter-spacing: -1px;
  line-height: 1;
}

.page-head .sub {
  margin-top:10px;
  font-size:12px; font-weight:300; letter-spacing:4px;
  text-transform:uppercase; color:var(--muted);
}

/* â”€â”€ Card â€” contenitore prodotti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  width:100%; max-width:560px;
  background:rgba(15,8,8,0.7);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:20px 20px 0 0;
  box-shadow:0 8px 40px rgba(0,0,0,0.5);
  animation: rise 0.7s 0.08s ease both;
  overflow:hidden;
}

.card-inner { padding:28px 28px 24px; }

/* Section head */
.s-head {
  display:flex; align-items:center; gap:10px;
  margin-bottom:16px;
}
.s-head .s-label {
  font-size:9px; font-weight:600; letter-spacing:5px;
  text-transform:uppercase; color:var(--muted);
}
.s-head::after {
  content:""; flex:1; height:1px;
  background:var(--border);
}

/* â”€â”€ Products list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prod-list {
  display:flex; flex-direction:column; gap:6px;
  max-height:310px; overflow-y:auto;
  padding-right:2px;
}
.prod-list::-webkit-scrollbar { width:3px; }
.prod-list::-webkit-scrollbar-thumb { background:rgba(200,51,63,0.3); border-radius:10px; }
.prod-list::-webkit-scrollbar-track { background:transparent; }

/* Column header */
.col-head {
  display:grid;
  grid-template-columns:1fr 96px 72px;
  gap:12px; padding:0 6px 8px;
  border-bottom:1px solid var(--border);
  margin-bottom:4px;
}
.col-head span {
  font-size:9px; font-weight:600; letter-spacing:3px;
  text-transform:uppercase; color:rgba(255,255,255,0.22);
}
.col-head .c-qty  { text-align:center; }
.col-head .c-price{ text-align:right; }

/* Product row */
.prod-row {
  display:grid;
  grid-template-columns:1fr 96px 72px;
  align-items:center; gap:12px;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid transparent;
  transition:all 0.2s ease;
  position:relative;
}
.prod-row:hover {
  background:rgba(255,255,255,0.04);
  border-color:var(--border);
}

.prod-info { display:flex; align-items:center; gap:8px; min-width:0; }

.prod-note-btn {
  flex-shrink:0;
  width:26px; height:26px;
  border-radius:7px;
  background:transparent;
  border:1px solid var(--border);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:all 0.2s;
  color:var(--muted);
}
.prod-note-btn:hover { background:var(--red-dim); border-color:rgba(200,51,63,0.4); color:rgba(200,51,63,0.9); }
.prod-note-btn svg { width:12px; height:12px; stroke:currentColor; fill:none; stroke-width:2; stroke-linecap:round; }

.prod-name {
  font-size:14px; font-weight:500; color:white;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  line-height:1.3;
}

/* Qty stepper */
.qty-ctrl { display:flex; align-items:center; justify-content:center; gap:6px; }
.qty-btn {
  width:24px; height:24px;
  background:var(--surface); border:1px solid var(--border);
  border-radius:6px; color:var(--muted); font-size:14px; font-weight:600;
  cursor:pointer; display:flex; align-items:center; justify-content:center;
  transition:all 0.18s; line-height:1;
}
.qty-btn:hover { background:var(--red-dim); border-color:rgba(200,51,63,0.4); color:white; }
.qty-num {
  font-size:14px; font-weight:600; color:white;
  min-width:18px; text-align:center;
}

/* Price */
.prod-price {
  font-size:14px; font-weight:600; color:rgba(255,255,255,0.75);
  text-align:right; white-space:nowrap;
}

/* â”€â”€ Inputs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.inputs-block { padding:0 28px 28px; display:flex; flex-direction:column; gap:10px; }

.field { position:relative; }
.field i {
  position:absolute; left:14px; top:50%; transform:translateY(-50%);
  font-size:13px; color:var(--muted); pointer-events:none; z-index:2;
}
.field input,
.field select {
  width:100%;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:10px;
  padding:13px 14px 13px 40px;
  font-size:13.5px; font-weight:400;
  font-family:var(--sans); color:white; outline:none;
  transition:all 0.2s; appearance:none;
}
.field input::placeholder { color:rgba(255,255,255,0.3); }
.field input:focus,
.field select:focus {
  border-color:rgba(200,51,63,0.45);
  background:rgba(255,255,255,0.06);
}
.field input.err,
.field select.err { border-color:var(--red); }

.field .sel-arrow {
  position:absolute; right:13px; top:50%; transform:translateY(-50%);
  pointer-events:none; color:var(--muted); font-size:11px;
}

/* â”€â”€ Checkout bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.checkout {
  width:100%; max-width:560px;
  background:rgba(10,5,5,0.88);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-top:1px solid rgba(200,51,63,0.2);
  border-radius:0 0 20px 20px;
  margin-top:-1px;
  box-shadow:0 20px 60px rgba(0,0,0,0.6);
  animation: rise 0.7s 0.16s ease both;
}

.checkout-total {
  display:flex; align-items:center;
  padding:20px 28px 14px;
  gap:16px;
}

.total-label-col { flex:1; }
.total-label-col .tl { font-size:9px; font-weight:600; letter-spacing:4px; text-transform:uppercase; color:var(--muted); margin-bottom:4px; }
.total-label-col .ta {
  font-family:var(--serif);
  font-size:38px; font-weight:400; font-style:italic;
  color:white; letter-spacing:-1px; line-height:1;
}
.total-label-col .ta .cur { font-size:18px; font-style:normal; color:var(--muted); margin-right:1px; vertical-align:super; }

.trash-btn {
  width:40px; height:40px; flex-shrink:0;
  border-radius:10px; background:var(--surface); border:1px solid var(--border);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition:all 0.2s; color:var(--muted);
}
.trash-btn:hover { background:var(--red-dim); border-color:rgba(200,51,63,0.4); color:rgba(200,51,63,0.9); }
.trash-btn svg { width:16px; height:16px; stroke:currentColor; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }

.checkout-form { padding:0 28px 28px; display:flex; flex-direction:column; gap:10px; }

.name-row { display:grid; grid-template-columns:1fr 1fr; gap:10px; }

.submit-btn {
  width:100%;
  background:var(--red);
  color:white; border:none;
  padding:17px 28px;
  font-size:12px; font-weight:600; letter-spacing:3px; text-transform:uppercase;
  border-radius:12px; cursor:pointer; transition:all 0.3s ease;
  font-family:var(--sans);
  display:flex; align-items:center; justify-content:center; gap:10px;
  box-shadow:0 4px 24px rgba(200,51,63,0.35);
  position:relative; overflow:hidden;
}
.submit-btn::before {
  content:""; position:absolute; inset:0;
  background:linear-gradient(135deg, rgba(255,255,255,0.08) 0%, transparent 60%);
  opacity:0; transition:opacity 0.3s;
}
.submit-btn:hover { transform:translateY(-2px); box-shadow:0 8px 32px rgba(200,51,63,0.5); }
.submit-btn:hover::before { opacity:1; }

/* â”€â”€ Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay {
  position:fixed; inset:0;
  background:rgba(0,0,0,0.65);
  backdrop-filter:blur(6px);
  z-index:200; opacity:0; display:none; transition:opacity 0.3s;
}
.overlay.active { display:block; opacity:1; }

/* â”€â”€ Popup base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.popup {
  position:fixed; top:50%; left:50%;
  transform:translate(-50%,-50%) scale(0.9);
  transition:transform 0.28s cubic-bezier(0.34,1.56,0.64,1), opacity 0.25s;
  opacity:0; display:none; z-index:300;
  width:360px; max-width:92vw;
  background:#0f0808;
  border:1px solid var(--border);
  border-radius:20px;
  box-shadow:0 32px 80px rgba(0,0,0,0.8);
  overflow:hidden;
  font-family:var(--sans);
}
.popup.active { display:block; transform:translate(-50%,-50%) scale(1); opacity:1; }
.popup-top-line { height:2px; background:linear-gradient(90deg,transparent,var(--red),transparent); opacity:0.6; }
.popup-body { padding:28px 26px; }
.popup-title {
  font-family:var(--serif); font-size:22px; font-style:italic; font-weight:400;
  color:white; margin-bottom:6px;
}
.popup-sub { font-size:12.5px; color:var(--muted); line-height:1.7; }

/* Note popup */
#note-popup .ing-list { display:flex; flex-direction:column; gap:6px; margin-top:18px; }
.ing-item {
  padding:10px 14px;
  background:var(--surface); border:1px solid var(--border); border-radius:9px;
  font-size:13px; font-weight:400; color:rgba(255,255,255,0.8);
}
.popup-close-btn {
  display:block; width:100%;
  margin-top:16px; padding:13px;
  background:transparent; border:1px solid var(--border); border-radius:10px;
  color:var(--muted); font-size:11px; font-weight:600; letter-spacing:2px; text-transform:uppercase;
  cursor:pointer; transition:all 0.2s; font-family:var(--sans);
}
.popup-close-btn:hover { border-color:var(--border-h); color:white; }

/* Success popup */
#success-popup .success-icon {
  width:60px; height:60px; margin:4px auto 16px;
  border-radius:50%;
  background:rgba(34,197,94,0.08); border:1px solid rgba(34,197,94,0.2);
  display:flex; align-items:center; justify-content:center;
}
#success-popup .success-icon svg { width:28px; height:28px; stroke:#4ade80; fill:none; stroke-width:2.5; stroke-linecap:round; stroke-linejoin:round; }
#success-popup .popup-body { text-align:center; }

/* Clear popup */
#clear-popup .clear-icon { font-size:28px; margin-bottom:12px; }
.popup-actions { display:flex; flex-direction:column; gap:8px; margin-top:20px; }
.btn-danger {
  width:100%; padding:14px;
  background:var(--red); color:white; border:none; border-radius:10px;
  font-size:12px; font-weight:600; letter-spacing:2.5px; text-transform:uppercase;
  cursor:pointer; font-family:var(--sans); transition:all 0.2s;
  display:flex; align-items:center; justify-content:center; gap:8px;
}
.btn-danger:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(200,51,63,0.4); }
.btn-ghost {
  width:100%; padding:12px;
  background:transparent; border:1px solid var(--border); border-radius:10px;
  color:var(--muted); font-size:11px; font-weight:600; letter-spacing:2px; text-transform:uppercase;
  cursor:pointer; font-family:var(--sans); transition:all 0.2s;
}
.btn-ghost:hover { border-color:var(--border-h); color:white; }

/* X button on popup */
.popup-x {
  position:absolute; top:14px; right:14px;
  width:28px; height:28px; display:flex; align-items:center; justify-content:center;
  border-radius:50%; background:var(--surface); border:1px solid var(--border);
  cursor:pointer; color:var(--muted); font-size:13px; font-weight:700;
  transition:all 0.2s; z-index:2;
}
.popup-x:hover { color:white; background:rgba(255,255,255,0.08); }

/* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes rise {
  from { opacity:0; transform:translateY(20px); }
  to   { opacity:1; transform:translateY(0); }
}
@keyframes shake {
  0%,100% { transform:translateX(0); }
  25%     { transform:translateX(-6px); }
  75%     { transform:translateX(6px); }
}
.shake { animation:shake 0.3s ease; }

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width:768px) {
  .navbar { height:64px; padding:0 20px; }
  .nav-links, .nav-social { display:none; }
  .nav-links.open { display:flex; flex-direction:column; position:fixed; top:64px; left:0; right:0; background:rgba(10,5,5,0.98); border-bottom:1px solid var(--border); padding:12px 0; }
  .nav-links.open a { padding:14px 24px; border-radius:0; border-bottom:1px solid var(--border); }
  .menu-toggle { display:block; }
  .card-inner { padding:20px 18px 18px; }
  .inputs-block { padding:0 18px 20px; }
  .checkout-form { padding:0 18px 22px; }
  .checkout-total { padding:16px 18px 10px; }
  .name-row { grid-template-columns:1fr; }
  .page { padding-top:88px; }
}
@media (max-width:480px) {
  .total-label-col .ta { font-size:30px; }
  .prod-list { max-height:260px; }
}
</style>
</head>
<body>

<!-- â”€â”€ NAVBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="navbar" id="navbar">
  <a class="nav-logo" href="/">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" onerror="this.style.visibility='hidden'">
    <div class="nav-logo-text">
      <span class="l1">Sala & Bar</span>
      <span class="l2">Scuola Borsa</span>
    </div>
  </a>

  <button class="menu-toggle" id="menu-toggle">â˜°</button>

  <ul class="nav-links" id="nav-links">
    <li><a href="/">Home</a></li>
    <li><a href="/#chi-siamo">Chi siamo</a></li>
    <li><a href="/#gallery">Galleria</a></li>
    <li><a href="/#contatti">Contatti</a></li>
    <li><a id="login-btn" href="#">Login</a></li>
  </ul>

  <div class="nav-social">
    <a href="https://www.facebook.com/aziendaspecialediformazionescuolapaoloborsa/" target="_blank"><i class="fab fa-facebook-f"></i></a>
    <a href="https://www.instagram.com/scuola_borsa/" target="_blank"><i class="fab fa-instagram"></i></a>
    <a href="https://www.youtube.com/@ScuolaPaoloBorsaMonza" target="_blank"><i class="fab fa-youtube"></i></a>
  </div>
</header>

<form action="{{ url_for('orders.new_order') }}" method="POST" id="order-form">
<div class="page">

  <!-- Header -->
  <div class="page-head">
    <div class="eyebrow">Riepilogo</div>
    <h1>Il tuo ordine</h1>
    <p class="sub">Controlla e conferma</p>
  </div>

  <!-- Prodotti card -->
  <div class="card">
    <div class="card-inner">
      <div class="s-head"><span class="s-label">Prodotti</span></div>

      <div class="col-head">
        <span>Prodotto</span>
        <span class="c-qty">QuantitÃ </span>
        <span class="c-price">Prezzo</span>
      </div>

      <div class="prod-list" id="product-container"></div>
      <input type="hidden" id="prodottiSelezionati" name="prodottiSelezionati">
    </div>

    <!-- Note generali -->
    <div class="inputs-block">
      <div class="s-head" style="margin-bottom:10px;"><span class="s-label">Note</span></div>
      <div class="field">
        <i class="fas fa-pen"></i>
        <input id="noteGenerali" type="text" name="noteGenerali"
               placeholder="Note aggiuntive (opzionale)"
               list="lista-note-generali" autocomplete="off"/>
        <datalist id="lista-note-generali">
          {% for gruppo in general_notes %}
            {% for nota in gruppo.note %}
              <option value="{{ nota.nome }}">
            {% endfor %}
          {% endfor %}
        </datalist>
      </div>
    </div>
  </div>

  <!-- Checkout panel -->
  <div class="checkout">
    <div class="checkout-total">
      <div class="total-label-col">
        <div class="tl">Totale ordine</div>
        <div class="ta"><span class="cur">â‚¬</span><span id="total-num">0,00</span></div>
      </div>
      <button class="trash-btn" id="clearCartBtn" type="button" title="Svuota carrello">
        <svg viewBox="0 0 24 24">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
          <path d="M10 11v6"/><path d="M14 11v6"/>
          <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
        </svg>
      </button>
    </div>

    <div class="checkout-form">
      <!-- Nome / Cognome -->
      <div class="name-row">
        <div class="field">
          <i class="fas fa-user"></i>
          <input id="nome" type="text" name="nome" placeholder="Nome"/>
        </div>
        <div class="field">
          <i class="fas fa-user"></i>
          <input id="cognome" type="text" name="cognome" placeholder="Cognome"/>
        </div>
      </div>

      <!-- Classe -->
      <div class="field">
        <i class="fas fa-graduation-cap"></i>
        <select id="classe" name="classe">
          <option value="" disabled selected>Seleziona classe o tavoloâ€¦</option>
          {% for c in listClass %}
            <option value="{{ c.nome }}">{{ c.nome }}</option>
          {% endfor %}
        </select>
        <span class="sel-arrow"><i class="fas fa-chevron-down"></i></span>
      </div>

      <input type="hidden" id="totalInput" name="total" value="0">

      <button class="submit-btn" id="invia" type="button">
        <i class="fas fa-paper-plane"></i>
        Conferma ordine
      </button>
    </div>
  </div>

</div>
</form>

<!-- Overlay -->
<div class="overlay" id="overlay"></div>

<!-- Note prodotto popup -->
<div class="popup" id="note-popup">
  <div class="popup-top-line"></div>
  <button class="popup-x" id="note-close">âœ•</button>
  <div class="popup-body">
    <div class="popup-title">Note prodotto</div>
    <div class="popup-sub">Ingredienti e varianti disponibili</div>
    <div class="ing-list" id="ingredient-container"></div>
    <button class="popup-close-btn" id="back">Chiudi</button>
  </div>
</div>

<!-- Success popup -->
<div class="popup" id="success-popup">
  <div class="popup-top-line" style="background:linear-gradient(90deg,transparent,#22c55e,transparent);"></div>
  <div class="popup-body">
    <div class="success-icon">
      <svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"/></svg>
    </div>
    <div class="popup-title">Ordine inviato!</div>
    <div class="popup-sub">Grazie per aver ordinato.<br>Il tuo ordine sarÃ  pronto al piÃ¹ presto.</div>
    <button class="popup-close-btn" id="success-close" style="margin-top:20px;">Chiudi</button>
  </div>
</div>

<!-- Clear popup -->
<div class="popup" id="clear-popup">
  <div class="popup-top-line"></div>
  <div class="popup-body">
    <div class="clear-icon">ðŸ—‘</div>
    <div class="popup-title">Svuota carrello</div>
    <div class="popup-sub">Vuoi rimuovere tutti i prodotti selezionati? L'operazione Ã¨ irreversibile.</div>
    <div class="popup-actions">
      <button class="btn-danger" id="clear-confirm"><i class="fas fa-trash-alt"></i> SÃ¬, svuota</button>
      <button class="btn-ghost" id="clear-cancel">Annulla</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  /* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  let sent = false;
  let products = JSON.parse(localStorage.getItem("orderedItems") || "[]")
                  .filter(p => p.name && !isNaN(p.price));

  /* â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const container  = document.getElementById("product-container");
  const overlay    = document.getElementById("overlay");
  const notePopup  = document.getElementById("note-popup");
  const ingBox     = document.getElementById("ingredient-container");
  const successPop = document.getElementById("success-popup");
  const clearPop   = document.getElementById("clear-popup");
  let   currentIdx = null;

  /* â”€â”€ Mobile nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const toggle   = document.getElementById("menu-toggle");
  const navLinks = document.getElementById("nav-links");
  toggle.addEventListener("click", () => navLinks.classList.toggle("open"));
  document.addEventListener("click", e => {
    if (!document.getElementById("navbar").contains(e.target))
      navLinks.classList.remove("open");
  });

  /* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function save() {
    localStorage.setItem("orderedItems", JSON.stringify(products));
    document.getElementById("prodottiSelezionati").value = JSON.stringify(products);
  }

  function fmt(n) {
    return n.toLocaleString("it-IT", { minimumFractionDigits:2, maximumFractionDigits:2 });
  }

  /* â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function render() {
    container.innerHTML = "";
    let total = 0;

    products.forEach((p, i) => {
      const qty = p.qty || 1;
      const row = document.createElement("div");
      row.className = "prod-row";
      row.innerHTML = `
        <div class="prod-info">
          <button class="prod-note-btn" data-i="${i}" type="button" title="Note">
            <svg viewBox="0 0 24 24">
              <path d="M12 20h9"/>
              <path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z"/>
            </svg>
          </button>
          <span class="prod-name" title="${p.name}">${p.name}</span>
        </div>
        <div class="qty-ctrl">
          <button class="qty-btn" data-i="${i}" data-a="âˆ’" type="button">âˆ’</button>
          <span class="qty-num">${qty}</span>
          <button class="qty-btn" data-i="${i}" data-a="+" type="button">+</button>
        </div>
        <div class="prod-price">â‚¬${fmt(p.price * qty)}</div>
      `;
      container.appendChild(row);
      total += p.price * qty;
    });

    document.getElementById("total-num").textContent = fmt(total);
    document.getElementById("totalInput").value = total.toFixed(2);
    document.getElementById("prodottiSelezionati").value = JSON.stringify(products);
  }

  /* â”€â”€ Product interactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  container.addEventListener("click", e => {
    const qb = e.target.closest(".qty-btn");
    if (qb) {
      const i = parseInt(qb.dataset.i);
      const a = qb.dataset.a;
      if (a === "+") products[i].qty = Math.min(10, (products[i].qty || 1) + 1);
      else           products[i].qty = Math.max(1,  (products[i].qty || 1) - 1);
      save(); render(); return;
    }
    const nb = e.target.closest(".prod-note-btn");
    if (nb) { currentIdx = parseInt(nb.dataset.i); openNotePopup(); }
  });

  /* â”€â”€ Note popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function openNotePopup() {
    ingBox.innerHTML = "";
    const prod = products[currentIdx];
    const ings = (prod && prod.ingredients && prod.ingredients.length)
      ? prod.ingredients
      : [prod ? prod.name : "â€”"];
    ings.forEach(ing => {
      const d = document.createElement("div");
      d.className = "ing-item"; d.textContent = ing;
      ingBox.appendChild(d);
    });
    openPopup(notePopup);
  }
  document.getElementById("back").addEventListener("click",       () => closePopup(notePopup));
  document.getElementById("note-close").addEventListener("click", () => closePopup(notePopup));

  /* â”€â”€ Success popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  document.getElementById("success-close").addEventListener("click", () => {
    closePopup(successPop);
    localStorage.removeItem("orderedItems");
    products = []; render();
    ["nome","cognome","noteGenerali"].forEach(id => {
      const el = document.getElementById(id); if(el) el.value = "";
    });
    const cl = document.getElementById("classe"); if(cl) cl.value = "";
  });

  /* â”€â”€ Clear popup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  document.getElementById("clearCartBtn").addEventListener("click", () => openPopup(clearPop));
  document.getElementById("clear-cancel").addEventListener("click", () => closePopup(clearPop));
  document.getElementById("clear-confirm").addEventListener("click", () => {
    localStorage.removeItem("orderedItems"); location.reload();
  });

  /* â”€â”€ Popup helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function openPopup(p) { overlay.classList.add("active"); p.classList.add("active"); }
  function closePopup(p){ overlay.classList.remove("active"); p.classList.remove("active"); }
  overlay.addEventListener("click", () => {
    [notePopup, successPop, clearPop].forEach(p => p.classList.remove("active"));
    overlay.classList.remove("active");
  });

  /* â”€â”€ Validation + submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  document.getElementById("invia").addEventListener("click", () => {
    if (sent) return;

    let ok = true;
    const nome    = document.getElementById("nome");
    const cognome = document.getElementById("cognome");
    const classe  = document.getElementById("classe");

    function check(el, regex) {
      el.classList.remove("err", "shake");
      if (!regex.test(el.value.trim())) {
        el.classList.add("err");
        void el.offsetWidth; // reflow per restart animation
        el.classList.add("shake");
        ok = false;
      }
    }

    check(nome,    /^[A-Za-zÃ€-Ã¶Ã¸-Ã¿\s]{2,}$/);
    check(cognome, /^[A-Za-zÃ€-Ã¶Ã¸-Ã¿\s]{2,}$/);
    check(classe,  /.+/);

    if (!ok) { nome.scrollIntoView({ behavior:"smooth", block:"center" }); return; }
    if (!products.length) { alert("Seleziona almeno un prodotto dal menu."); return; }

    document.getElementById("prodottiSelezionati").value = JSON.stringify(products);

    sent = true;
    openPopup(successPop);
    setTimeout(() => document.getElementById("order-form").submit(), 2800);
  });

  /* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  render();
});
</script>
</body>
</html>