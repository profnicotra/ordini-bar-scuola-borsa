<!DOCTYPE html>
<html lang="it">
<head> 
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ordina + Ingredienti</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "SF Pro Display", Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-image: url("https://static.wixstatic.com/media/a24994_e95a621e8db84322a7402a21df89543b~mv2.jpg");
      background-size: cover;
      position: relative;
      overflow: hidden;
    }
    body::after {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background:  rgba(31, 30, 30, 0.722);
      backdrop-filter: blur(6px);
      z-index: 0;
    }
    .card,
    .total-card {
      position: relative;
      z-index: 5;
      background-color: rgba(0, 0, 0, 0.841);
    }
    .card {
      width: 400px;
      border-radius: 18px;
      padding: 22px;
      color: white;
      text-align: left;
      backdrop-filter: blur(4px);
      margin-bottom: 18px;
      max-height: 350px;
      overflow-y: auto;
    }
    h2 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 22px;
      font-weight: 700;
    }
    .divider {
      height: 1px;
      background:#e63946;
      margin: 20px 0 16px 0;
      height:3px;
      border-radius: 30px;
    }
      .divider1 {
      height: 1px;
      background:#e63946;
      height:3px;
      border-radius: 30px;
    }
    .header-row,
    .product-row {
      display: grid;
      grid-template-columns: 140px 140px 80px;
      text-align: center;
      align-items: center;
    }
    .header-row { margin-bottom:12px; font-size:18px; font-weight:600; }
    .product-row { margin-bottom:18px; font-size:15px; position: relative; }
    .product-name { text-align:left; display:flex; flex-direction:column; align-items:flex-start; gap:5px; }
    .qty-box { display:flex; justify-content:center; align-items:center; gap:8px; }
    .qty-btn { background: rgba(255,255,255,0.18); padding:4px 12px; border-radius:8px; border:none; font-size:18px; color:white; cursor:pointer; }
    .price { text-align:right; padding-right:8px; font-size:17px; font-weight:500; font-family:'Segoe UI'; }
    .ingredient-list { font-size:13px; color:#e63946; font-weight:600; }
    .total-card { width:410px; background: rgba(0, 0, 0, 0.841); padding:16px; border-radius:0 0 16px 16px; margin-top:-15px; display:flex; color:white; justify-content:space-between; align-items:center; }
    .total-price { font-size:25px; font-weight:700; min-width:90px; text-align:right; }
    .checkout-btn { background:#e63946; color:white; border:none; padding:10px 26px; font-size:16px; font-weight:800; border-radius:30px; cursor:pointer; transition:0.2s; }
    .checkout-btn:hover { background:white; color:black; }
    .card::-webkit-scrollbar { width:10px; }
    .card::-webkit-scrollbar-track { background:#333; border-radius:10px; }
    .card::-webkit-scrollbar-thumb { background-color:white; border-radius:10px; border:2px solid #333; }
    .card::-webkit-scrollbar-thumb:hover { background-color:#e63946; }
    .note-input { font-size:100%; padding:0.8em; outline:none; border:2px solid white; background-color:transparent; border-radius:20px; width:365px; color:white; }

    .info-input { font-size:100%;margin-top: 8px; padding:0.8em; outline:none; border:2px solid white; background-color:transparent; border-radius:20px; width:365px; color:white; }

   
    /* Overlay / popup styles */
    .overlay { 
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.6);
      opacity: 0; display:none; transition: opacity .3s ease; z-index:10;
    }
    .overlay.active { display:block; opacity:1; }

    #ingredient-card {
      width: 300px;
      background: rgba(0, 0, 0, 0.914);
      border-radius: 20px;
      padding: 24px;
      display: none;
      flex-direction: column;
      gap: 20px;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      z-index: 15;
    }

    #ingredient-card .title { color:white; text-align:center; font-size:24px; font-weight:800; }

    #ingredient-card .controls { display:flex; justify-content:space-between; margin-top:20px; }

    #ingredient-card .btn { width:115px; padding:14px; border-radius:25px; background:#e63946; color:white; font-weight:800; border:none; cursor:pointer; }
    #ingredient-card .btn:hover { background:white; color:black; }

    #popup-ingredienti {
      width: 300px;
      background: rgba(0, 0, 0, 0.873);
      padding:20px;
      border-radius:30px;
      display:none;
      flex-direction: column;
      gap:15px;
      color:white;
      position: fixed;
      top:50%; left:50%;
      transform: translate(-50%, -50%) scale(.6);
      opacity:2;
      transition: .25s ease;
      z-index:20;
    }
    #popup-ingredienti.active { display:flex; transform: translate(-50%, -50%) scale(1); opacity:1; }
    .ingredient-row { display:flex; justify-content:space-between; align-items:center; width:100%; margin-bottom:18px; }
    .ingredient-item { display:flex; align-items:center; gap:8px; font-size:16px; }
    .neu-btn { background:white; border-radius:12px; padding:8px 14px; font-weight:700; border:none; cursor:pointer; color:black; transition:0.2s; }
    .neu-btn.active-extra { background:#e63946; color:white; }
    .remove-checkbox { position:absolute; opacity:0; }
    .check-icon { width:18px; height:18px; display:flex; align-items:center; justify-content:center; margin-right:8px; font-size:22px; color:#e63946; cursor:pointer; }
    .check-icon::before { content:"—"; }
    .remove-checkbox:checked + .check-icon::before { content:"✔"; font-size:18px; }
    .remove-checkbox:checked ~ label { text-decoration:line-through; color:#bbbbbb; }
    .nav-buttons { display:flex; justify-content:space-between; width:100%; margin-top:12px; }
    .nav-btn { background:#e63946; color:white; border:none; padding:10px 18px; border-radius:20px; font-weight:700; cursor:pointer; }
    .nav-btn:hover { background:white; color:black; }
    .nav-btn1 { background:#e63946; color:white; border:none; padding:10px 18px; border-radius:20px; font-weight:700; cursor:pointer;width:150px;height: 43px;font-family: verdana;font-size: 15px;border: 2px solid white; }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    .input-error {
      border-color: #e63946 !important;
      animation: shake 0.35s ease;
    }

    .input-error::placeholder {
      color: #ffb3b3 !important;
      opacity: 1;
    }

  </style>
</head>

<body>

  <div class="card">

    <h2 style="font-size:30px;font-weight:800;font-family:verdana;">ORDINA</h2>
    <div class="divider"></div>

    <div class="header-row">
      <div style="text-align:left;padding-left:8px;">Prodotto</div>
      <div>Quantità</div>
      <div style="text-align:right;">Prezzo</div>
    </div>

    <div id="product-container"></div>

    <div class="divider"></div>

    <h2 style="margin-top:60px;">Feedback</h2>
    <div class="divider"></div>

    <input type="text" class="note-input" placeholder="Feedback"/>

    <h3 style="margin-top:40px;text-align: center;font-size: 23px;">INFO</h3>
    <div class="divider"></div>

    <div class="input">
      <input id="nome" type="text" class="info-input" placeholder="Nome"/>
      <div id="err-nome" class="error-msg"></div>
    </div>

    <div class="input">
      <input id="cognome" type="text" class="info-input" placeholder="Cognome"/>
      <div id="err-cognome" class="error-msg"></div>
    </div>

<div class="input">
      <input id="classe" type="text" class="info-input" placeholder="Classe" list="lista-classi"/>
      <datalist id="lista-classi">
        <option value="1D Operatore Informatica">
        <option value="2D Operatore Informatica">
        <option value="3D Operatore Informatica">
        <option value="1D Bar&Cucina">
        <option value="2D Bar&Cucina">
        <option value="3D Bar&Cucina">
        <option value="1D Agricoltura">
        <option value="2D Agricoltura">
        <option value="3D Agricoltura">
      </datalist>
      <div id="err-classe" class="error-msg"></div>
    </div>

  </div>

  <div class="total-card">
    <div class="total-price" id="total">€0,00</div>
    <button class="checkout-btn" id="invia">INVIA</button>
  </div>

  <div class="overlay" id="overlay"></div>

  <div id="ingredient-card">
    <h1 class="title">Perzonalizza</h1>
    <div class="divider1" style="width:100px;margin-left:100px;margin-bottom:20px;"></div>

    <!-- ⭐⭐⭐ AGGIUNTO: BOTTONE NOTE ⭐⭐⭐ -->
    <button class="nav-btn1" id="note" style="align-self:center; margin-top:20px;border:2px soli white;">Note</button>
    <!-- ⭐⭐⭐ FINE AGGIUNTA ⭐⭐⭐ -->

    <div class="controls">
      <button class="btn" id="aggiungi">Aggiungi</button>
      <button class="btn" id="rimuovi" style="background-color:transparent ;color: transparent;">Rimuovi</button>
    </div>
  </div>

  <div id="popup-ingredienti">
    <h2 style="color:white;font-weight:800;font-family:verdana;font-size:20px;text-align:center;">AGGIUNGI NOTE</h2>
    <div class="divider"></div>
    <div id="ingredient-container"></div>
    <div class="nav-buttons">
      <button class="nav-btn" id="next">Salva</button>
      <button class="nav-btn" id="back">Chiudi</button>
    </div>
  </div>


<script>
/* === TUTTO IL TUO SCRIPT ORIGINALE === */

let products = JSON.parse(localStorage.getItem("orderedItems")) || [];
products = products.filter(p => p.name && !isNaN(p.price));

let productContainer = document.getElementById("product-container");
let totalPriceEl = document.getElementById("total");

const ingredientiProdotto = {
  "Focaccia": ["Pane", "Pomodoro", "Mozzarella"],
  "Cup Cake": ["Farina", "Zucchero", "Burro", "Uova", "Vaniglia"],
  "Pizzette": ["Pomodoro", "Mozzarella", "Basilico"],
  "Panino": ["Pane", "Prosciutto", "Formaggio", "Insalata"],
};

function generaIngredientiDefault(nomeProdotto) {
  return [`${nomeProdotto} Base`, "Sale", "Olio", "Ingrediente Standard"];
}

products.forEach(prod => {
  if (!prod.ingredients || prod.ingredients.length === 0) {
    if (ingredientiProdotto[prod.name]) prod.ingredients = [...ingredientiProdotto[prod.name]];
    else prod.ingredients = generaIngredientiDefault(prod.name);
    prod.extra = [];
    prod.removed = [];
  }
  if (!prod.extra) prod.extra = [];
  if (!prod.removed) prod.removed = [];
});

localStorage.setItem("orderedItems", JSON.stringify(products));

let currentProductIndex = null;

function renderProducts() {
  productContainer.innerHTML = "";
  let total = 0;

  products.forEach((p,i) => {
    let row = document.createElement("div");
    row.className="product-row";

    row.innerHTML = `
      <div class="product-name">
        <div style="display:flex; align-items:center; gap:10px;">
          <button class="note-btn" data-index="${i}"
            style="width:42px;height:42px;border-radius:50%;
                   background:#f5f0e7;border:2px solid #d9d4cc;
                   display:flex;justify-content:center;align-items:center;cursor:pointer;">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="black"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 20h9"/>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
            </svg>
          </button>
          <span>${p.name}</span>
        </div>

        ${p.extra.length ? `<div class="ingredient-list">Extra: ${p.extra.join(', ')}</div>` : ''}
        ${p.removed.length ? `<div class="ingredient-list">No: ${p.removed.join(', ')}</div>` : ''}
      </div>

      <div class="qty-box">
        <button class="qty-btn" data-index="${i}" data-action="minus">-</button>
        <span class="qty">${p.qty||1}</span>
        <button class="qty-btn" data-index="${i}" data-action="plus">+</button>
      </div>

      <div class="price">€${p.price*(p.qty||1)}</div>
    `;

    productContainer.appendChild(row);

    total += p.price*(p.qty||1);
  });

  totalPriceEl.textContent = `€${total},00`;

  document.querySelectorAll(".qty-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      let index = btn.dataset.index;
      if (btn.dataset.action === "plus") products[index].qty++;
      else products[index].qty = Math.max(1, products[index].qty - 1);
      localStorage.setItem("orderedItems", JSON.stringify(products));
      renderProducts();
    });
  });

  enableMatite();
}

renderProducts();

const overlay = document.getElementById("overlay");
const ingredientCard = document.getElementById("ingredient-card");
const popupIngredienti = document.getElementById("popup-ingredienti");
const ingredientContainer = document.getElementById("ingredient-container");

const addBtn = document.getElementById("aggiungi");
const removeBtn = document.getElementById("rimuovi");
const backBtn = document.getElementById("back");
const nextBtn = document.getElementById("next");

/* ⭐⭐⭐ AGGIUNTO: EVENTO CLICK PER IL BOTTONE NOTE ⭐⭐⭐ */
document.getElementById("note").addEventListener("click", () => {
  alert("Aggiungi una nota per questo prodotto!");
});
/* ⭐⭐⭐ FINE AGGIUNTA ⭐⭐⭐ */

function showIngredientCard() {
  ingredientCard.style.display = "flex";
  overlay.classList.add("active");
}

function hideIngredientCard() {
  ingredientCard.style.display = "none";
  overlay.classList.remove("active");
}

function showPopup(extraMode){
  ingredientContainer.innerHTML="";

  const prod = products[currentProductIndex];
  const listaIngredienti = ingredientiProdotto[prod.name] || prod.ingredients;

  listaIngredienti.forEach((ing,index)=>{
    const row = document.createElement("div");
    row.className="ingredient-row";

    const left = document.createElement("div");
    left.className="ingredient-item";

    if(extraMode){
      left.textContent = ing;
      const btn = document.createElement("button");
      btn.className="neu-btn";
      btn.textContent="Extra";

      if(prod.extra.includes(ing)) btn.classList.add("active-extra");

      btn.addEventListener("click",()=>{btn.classList.toggle("active-extra")});

      row.appendChild(left);
      row.appendChild(btn);

    } else {
      const id = "rem"+index;
      const checked = prod.removed.includes(ing)?'checked':'';

      left.innerHTML=`
        <input type="checkbox" id="${id}" class="remove-checkbox" ${checked}>
        <span class="check-icon"></span>
        <label for="${id}">${ing}</label>
      `;

      row.appendChild(left);
    }

    ingredientContainer.appendChild(row);
  });

  popupIngredienti.classList.add("active");
}

function hidePopup(){
  popupIngredienti.classList.remove("active");
}

addBtn.addEventListener("click",()=>{
  if(currentProductIndex!==null) showPopup(true);
});

removeBtn.addEventListener("click",()=>{
  if(currentProductIndex!==null) showPopup(false);
});

backBtn.addEventListener("click",hidePopup);

nextBtn.addEventListener("click", ()=>{
  if(currentProductIndex===null) return;

  const prod = products[currentProductIndex];

  const newExtra = [...prod.extra];
  const newRemoved = [...prod.removed];

  ingredientContainer.querySelectorAll(".neu-btn").forEach((btn,i)=>{
    const listaIngredienti = ingredientiProdotto[prod.name] || prod.ingredients;

    if(btn.classList.contains("active-extra") && !newExtra.includes(listaIngredienti[i]))
      newExtra.push(listaIngredienti[i]);

    if(!btn.classList.contains("active-extra") && newExtra.includes(listaIngredienti[i])) {
      const idx = newExtra.indexOf(listaIngredienti[i]);
      if(idx>-1) newExtra.splice(idx,1);
    }
  });

  ingredientContainer.querySelectorAll(".remove-checkbox").forEach((cb,i)=>{
    const listaIngredienti = ingredientiProdotto[prod.name] || prod.ingredients;

    if(cb.checked && !newRemoved.includes(listaIngredienti[i]))
      newRemoved.push(listaIngredienti[i]);

    if(!cb.checked && newRemoved.includes(listaIngredienti[i])) {
      const idx = newRemoved.indexOf(listaIngredienti[i]);
      if(idx>-1) newRemoved.splice(idx,1);
    }
  });

  prod.extra = newExtra;
  prod.removed = newRemoved;

  localStorage.setItem("orderedItems", JSON.stringify(products));

  hidePopup();
  renderProducts();
});

overlay.addEventListener("click", ()=>{
  hideIngredientCard();
  hidePopup();
});

function enableMatite(){
  document.querySelectorAll(".note-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      currentProductIndex = btn.dataset.index;
      showIngredientCard();
    });
  });
}


// ===== VALIDAZIONE =====

const inputNome = document.getElementById("nome");
const inputCognome = document.getElementById("cognome");
const inputClasse = document.getElementById("classe");

const errN = document.getElementById("err-nome");
const errC = document.getElementById("err-cognome");
const errCL = document.getElementById("err-classe");

function triggerInputError(input) {
  input.classList.remove('input-error');
  void input.offsetWidth;
  input.classList.add('input-error');
}

[inputNome, inputCognome, inputClasse].forEach(inp => {
  inp.addEventListener('input', () => {
    inp.classList.remove('input-error');
    const relatedErr = document.getElementById('err-' + inp.id);
    if (relatedErr) relatedErr.style.display = 'none';
  });
});

document.getElementById("invia").addEventListener("click", () => {

  let nome = inputNome;
  let cognome = inputCognome;
  let classe = inputClasse;

  let valido = true;

  if (nome.value.trim() === "") {
    errN.style.display = "block";
    triggerInputError(nome);
    valido = false;
  } else {
    errN.style.display = "none";
    nome.classList.remove('input-error');
  }

  if (cognome.value.trim() === "") {
    errC.style.display = "block";
    triggerInputError(cognome);
    valido = false;
  } else {
    errC.style.display = "none";
    cognome.classList.remove('input-error');
  }

  if (classe.value.trim() === "") {
    errCL.style.display = "block";
    triggerInputError(classe);
    valido = false;
  } else {
    errCL.style.display = "none";
    classe.classList.remove('input-error');
  }

  if (valido) {
    alert("Il tuo ordine è stato mandato al bar");
  }
});

</script>

</body>
</html>
