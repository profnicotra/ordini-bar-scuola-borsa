<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ordina + Ingredienti</title>
  <link rel="stylesheet" href="static/order.css">
</head>

<body>

  <div class="card">
    <h2 style="font-size:30px;font-weight:800;font-family:verdana;">ORDINA</h2>
    <div class="divider"></div>
    <div class="header-row">
      <div style="text-align:left;padding-left:8px;">Prodotto</div>
      <div>Quantità</div>
      <div style="text-align:right;">Prezzo</div>
    </div>
    <div id="product-container"></div>
    <div class="divider"></div>
    <h2 style="margin-top:60px;">Feedback</h2>
    <div class="divider"></div>
    <input type="text" class="note-input" placeholder="Note"/>
    <h3 style="margin-top:40px;text-align: center;font-size: 23px;">INFO</h3>
    <div class="divider"></div>
    <div class="input"><input type="text"  class="info-input" placeholder="Nome"/></div>
    <div class="input"><input type="text" class="info-input" placeholder="Cognome"/></div>
    <div class="input"><input type="text" class="info-input" placeholder="Classe"/></div>
  </div>

  <div class="total-card">
    <div class="total-price" id="total">€0,00</div>
    <button class="checkout-btn">INVIA</button>
  </div>

  <div class="overlay" id="overlay"></div>

  <div id="ingredient-card">
    <h1 class="title">INGREDIENTI</h1>
    <div class="controls">
      <button class="btn" id="aggiungi">Aggiungi</button>
      <button class="btn" id="rimuovi">Rimuovi</button>
    </div>
  </div>

  <div id="popup-ingredienti">
    <h2 style="color:white;font-weight:800;font-family:verdana;font-size:20px;text-align:center;">LISTA INGREDIENTI</h2>
    <div class="divider"></div>
    <div id="ingredient-container"></div>
    <div class="nav-buttons">
      <button class="nav-btn" id="next">Salva</button>
      <button class="nav-btn" id="back">Indietro</button>
    </div>
  </div>

<script>
let products = JSON.parse(localStorage.getItem("orderedItems")) || [];
products = products.filter(p => p.name && !isNaN(p.price));
let productContainer = document.getElementById("product-container");
let totalPriceEl = document.getElementById("total");

const ingredientiProdotto = {
  "Focaccia": ["Pane", "Pomodoro", "Mozzarella"],
  "Cup Cake": ["Farina", "Zucchero", "Burro", "Uova", "Vaniglia"],
  "Pizzette": ["Pomodoro", "Mozzarella", "Basilico"],
};

function generaIngredientiDefault(nomeProdotto) {
  return [`${nomeProdotto} Base`, "Sale", "Olio", "Ingrediente Standard"];
}

products.forEach(prod => {
  if (!prod.ingredients || prod.ingredients.length === 0) {
    if (ingredientiProdotto[prod.name]) prod.ingredients = [...ingredientiProdotto[prod.name]];
    else prod.ingredients = generaIngredientiDefault(prod.name);
    prod.extra = [];
    prod.removed = [];
  }
  if (!prod.extra) prod.extra = [];
  if (!prod.removed) prod.removed = [];
});

localStorage.setItem("orderedItems", JSON.stringify(products));

let currentProductIndex = null;

function renderProducts() {
  productContainer.innerHTML = "";
  let total = 0;

  products.forEach((p,i) => {
    let row = document.createElement("div");
    row.className="product-row";

    row.innerHTML = `
      <div class="product-name">
        <div style="display:flex; align-items:center; gap:10px;">
          <button class="note-btn" data-index="${i}" 
            style="width:42px;height:42px;border-radius:50%;
                   background:#f5f0e7;border:2px solid #d9d4cc;
                   display:flex;justify-content:center;align-items:center;cursor:pointer;">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="black"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 20h9"/>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
            </svg>
          </button>
          <span>${p.name}</span>
        </div>
        ${p.extra.length ? `<div class="ingredient-list">Extra: ${p.extra.join(', ')}</div>` : ''}
        ${p.removed.length ? `<div class="ingredient-list">No: ${p.removed.join(', ')}</div>` : ''}
      </div>
      <div class="qty-box">
        <button class="qty-btn" data-index="${i}" data-action="minus">-</button>
        <span class="qty">${p.qty||1}</span>
        <button class="qty-btn" data-index="${i}" data-action="plus">+</button>
      </div>
      <div class="price">€${p.price*(p.qty||1)}</div>
    `;

    productContainer.appendChild(row);
    total += p.price*(p.qty||1);
  });

  totalPriceEl.textContent = `€${total},00`;

  document.querySelectorAll(".qty-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      let index = btn.dataset.index;
      if (btn.dataset.action === "plus") products[index].qty++;
      else products[index].qty = Math.max(1, products[index].qty - 1);
      localStorage.setItem("orderedItems", JSON.stringify(products));
      renderProducts();
    });
  });

  enableMatite();
  <title>Ordina + Ingredienti</title>
e
  <link rel="stylesheet" href="static/styles.css">